<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>로그인/로그아웃 데모</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; margin: 0; padding: 24px; background: #0b0f14; color: #e8eef6; }
    .wrap { max-width: 920px; margin: 0 auto; }
    .card { background: #111826; border: 1px solid #263248; border-radius: 14px; padding: 18px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 820px) { .row { grid-template-columns: 1fr; } }

    h1 { margin: 0 0 12px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; }
    p  { margin: 8px 0; line-height: 1.5; color: #c9d6ea; }
    label { display: block; margin: 12px 0 6px; color: #c9d6ea; font-size: 14px; }
    input {
      width: 100%; padding: 12px 12px; border-radius: 10px;
      border: 1px solid #2b3a55; background: #0b1220; color: #e8eef6;
      outline: none;
    }
    input:focus { border-color: #6aa8ff; }
    .btns { display: flex; gap: 10px; margin-top: 14px; flex-wrap: wrap; }
    button {
      padding: 12px 14px; border-radius: 10px; border: 1px solid #2b3a55;
      background: #15223a; color: #e8eef6; cursor: pointer;
    }
    button.primary { background: #2a6fff; border-color: #2a6fff; color: white; }
    button.danger  { background: #2a1520; border-color: #5a2a3a; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .hint { font-size: 13px; color: #9fb3d3; }
    .msg { margin-top: 10px; padding: 10px 12px; border-radius: 10px; border: 1px solid #2b3a55; background: #0b1220; color: #cfe0ff; display: none; }
    .msg.show { display: block; }
    .pill { display: inline-flex; gap: 8px; align-items: center; padding: 6px 10px; border-radius: 999px; border: 1px solid #2b3a55; background: #0b1220; color: #c9d6ea; font-size: 13px; }
    .top { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .divider { height: 1px; background: #263248; margin: 14px 0; }
    .small { font-size: 12px; color: #9fb3d3; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h1>로그인 / 로그아웃 데모</h1>
      <div id="statusPill" class="pill">상태: <span id="statusText">확인 중…</span></div>
    </div>

    <div class="row">
      <!-- 회원가입 카드 -->
      <section class="card" aria-label="회원가입">
        <h2>회원가입</h2>
        <p class="hint">연습용 데모입니다. 입력값은 내 컴퓨터(브라우저)에만 저장됩니다.</p>

        <label for="suEmail">이메일</label>
        <input id="suEmail" type="email" placeholder="example@email.com" autocomplete="email" />

        <label for="suPw">비밀번호</label>
        <input id="suPw" type="password" placeholder="8자 이상 권장" autocomplete="new-password" />

        <div class="btns">
          <button class="primary" id="btnSignup">회원가입</button>
          <button id="btnResetDemo" class="danger" title="저장된 계정/로그인 상태를 삭제합니다.">데모 초기화</button>
        </div>

        <div id="msgSignup" class="msg" role="status" aria-live="polite"></div>
        <div class="divider"></div>
        <p class="small">
          저장 위치: <span class="mono">localStorage</span> (브라우저 저장공간)
        </p>
      </section>

      <!-- 로그인 카드 -->
      <section class="card" aria-label="로그인">
        <h2>로그인</h2>

        <label for="liEmail">이메일</label>
        <input id="liEmail" type="email" placeholder="가입한 이메일" autocomplete="email" />

        <label for="liPw">비밀번호</label>
        <input id="liPw" type="password" placeholder="가입한 비밀번호" autocomplete="current-password" />

        <div class="btns">
          <button class="primary" id="btnLogin">로그인</button>
          <button id="btnLogout">로그아웃</button>
        </div>

        <div id="msgLogin" class="msg" role="status" aria-live="polite"></div>

        <div class="divider"></div>

        <div id="privateArea" style="display:none;">
          <h2>로그인 후에만 보이는 영역</h2>
          <p>환영합니다, <b id="who"></b> 님!</p>
          <p class="hint">이 영역은 “로그인 상태”가 있을 때만 표시됩니다.</p>
        </div>

        <div id="publicArea">
          <p class="hint">아직 로그인하지 않았습니다. 로그인하면 아래에 개인 영역이 나타납니다.</p>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ============================
    // 연습용 "가짜 인증" (localStorage)
    // ============================
    // 계정 저장 키
    const KEY_USERS = "demo_users";      // [{email, pwHash}]
    const KEY_TOKEN = "demo_token";      // 로그인 상태 토큰
    const KEY_ME    = "demo_me";         // 로그인한 사용자 이메일

    // 아주 단순한 해시(보안용 아님) - 데모용
    async function sha256(text) {
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    function readUsers() {
      try {
        return JSON.parse(localStorage.getItem(KEY_USERS) || "[]");
      } catch {
        return [];
      }
    }
    function writeUsers(users) {
      localStorage.setItem(KEY_USERS, JSON.stringify(users));
    }

    function setMsg(el, text) {
      el.textContent = text;
      el.classList.add("show");
    }
    function clearMsg(el) {
      el.textContent = "";
      el.classList.remove("show");
    }

    function isLoggedIn() {
      return Boolean(localStorage.getItem(KEY_TOKEN)) && Boolean(localStorage.getItem(KEY_ME));
    }

    function updateUI() {
      const loggedIn = isLoggedIn();
      const statusText = document.getElementById("statusText");
      const privateArea = document.getElementById("privateArea");
      const publicArea = document.getElementById("publicArea");
      const who = document.getElementById("who");

      if (loggedIn) {
        const me = localStorage.getItem(KEY_ME);
        statusText.textContent = "로그인됨";
        privateArea.style.display = "block";
        publicArea.style.display = "none";
        who.textContent = me;
      } else {
        statusText.textContent = "로그아웃됨";
        privateArea.style.display = "none";
        publicArea.style.display = "block";
        who.textContent = "";
      }
    }

    // 회원가입
    document.getElementById("btnSignup").addEventListener("click", async () => {
      const email = document.getElementById("suEmail").value.trim().toLowerCase();
      const pw = document.getElementById("suPw").value;

      const msg = document.getElementById("msgSignup");
      clearMsg(msg);

      if (!email || !pw) return setMsg(msg, "이메일과 비밀번호를 입력해 주세요.");
      if (pw.length < 6) return setMsg(msg, "비밀번호는 6자 이상을 권장합니다.");

      const users = readUsers();
      if (users.some(u => u.email === email)) {
        return setMsg(msg, "이미 가입된 이메일입니다. (로그인으로 진행해 주세요.)");
      }

      const pwHash = await sha256(pw);
      users.push({ email, pwHash });
      writeUsers(users);

      setMsg(msg, "회원가입 완료! 이제 오른쪽에서 로그인해 보세요.");
      document.getElementById("liEmail").value = email;
      document.getElementById("liPw").value = "";
    });

    // 로그인
    document.getElementById("btnLogin").addEventListener("click", async () => {
      const email = document.getElementById("liEmail").value.trim().toLowerCase();
      const pw = document.getElementById("liPw").value;

      const msg = document.getElementById("msgLogin");
      clearMsg(msg);

      if (!email || !pw) return setMsg(msg, "이메일과 비밀번호를 입력해 주세요.");

      const users = readUsers();
      const user = users.find(u => u.email === email);
      if (!user) return setMsg(msg, "가입된 계정을 찾을 수 없습니다. 먼저 회원가입을 진행해 주세요.");

      const pwHash = await sha256(pw);
      if (pwHash !== user.pwHash) return setMsg(msg, "비밀번호가 일치하지 않습니다.");

      // 로그인 상태 저장(토큰은 데모용 랜덤 문자열)
      localStorage.setItem(KEY_TOKEN, String(Math.random()).slice(2) + Date.now());
      localStorage.setItem(KEY_ME, email);

      setMsg(msg, "로그인 성공! 아래에 개인 영역이 표시됩니다.");
      updateUI();
    });

    // 로그아웃
    document.getElementById("btnLogout").addEventListener("click", () => {
      const msg = document.getElementById("msgLogin");
      clearMsg(msg);

      localStorage.removeItem(KEY_TOKEN);
      localStorage.removeItem(KEY_ME);

      setMsg(msg, "로그아웃되었습니다.");
      updateUI();
    });

    // 데모 초기화
    document.getElementById("btnResetDemo").addEventListener("click", () => {
      localStorage.removeItem(KEY_USERS);
      localStorage.removeItem(KEY_TOKEN);
      localStorage.removeItem(KEY_ME);

      clearMsg(document.getElementById("msgSignup"));
      clearMsg(document.getElementById("msgLogin"));
      setMsg(document.getElementById("msgSignup"), "데모가 초기화되었습니다. 다시 회원가입해 주세요.");
      updateUI();
    });

    // 최초 UI 반영
    updateUI();
  </script>
</body>
</html>
